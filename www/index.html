<html>
    <head>
        <title>Pomo Configuration</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div class="config">
            <form onclick="return false">
                <div class="form-item">
                    <button class="button-submit" onclick="scan_ssids()" id="scan-button">Scan SSIDs</button>
                </div>

                <div class="form-item">
                    <label for="ssid">SSID</label>
                    <select name="ssid" id="ssid"></select>
                </div>

                <div class="form-item">
                        <label for="password">Password</label>
                        <input type="password" name="Password" id="password">
                </div>

                <div class="form-item-h">
                    <button type="submit" class="button-submit" onclick="connect()">Save Credentials</button>
                    <button type="submit" class="button-submit" onclick="check_connection()">Check Connection</button>
                </div>
            </form>
        </div>

    <script>
        function scan_ssids() {
            let http = new XMLHttpRequest();
            let url = '/api/get_ssids';

            let button = document.getElementById('scan-button');
            button.innerHTML = "Scanning...";

            http.open('GET', url);
            http.send();
            http.onreadystatechange = function() {
                if (this.readyState == 4) {
                    if (http.status == 200) {
                        let data = JSON.parse(http.responseText);
                        console.log(data);

                        let dropdown = document.getElementById('ssid');
                        dropdown.length = 0;

                        let option;
                        for (let i = 0; i < data['ssids'].length; i++) {
                            option = document.createElement('option');
                            option.text = data['ssids'][i];
                            option.value = data['ssids'][i];
                            dropdown.add(option);
                        }

                        button.innerHTML = "Scan SSIDs";
                    } else {
                        button.innerHTML = "Error, please try again!";
                    }
                }
            }
        }

        function connect() {
            let ssid = document.getElementById('ssid');
            let password = document.getElementById('password');

            console.log(ssid.value);
            console.log(password.value);

            let http = new XMLHttpRequest();
            let url = '/api/connect';
            http.open("POST", url);
            http.send(JSON.stringify({ssid: ssid.value, password: password.value}));

            http.onreadystatechange = function() {
                if (this.readyState == 4) {
                    console.log(http.status, http.responseText);
                }
            }
        }

        function check_connection() {
            console.log("Not Implemented!");
        }
    </script>

    </body>
</html>